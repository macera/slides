<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Kunibiki.rb#8</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-markdown
           data-separator="\n---\n$"
           data-vertical="\n--\n">
           <script type="text/template">
# Kunibiki.rb#8

LT & ハンズオン

---

## Rails+GraphQL+Reactで簡単なアプリを作る

---

### おしながき

1. 私がGraphQLを使い始めたワケ
2. GraphQLとは
3. GraphQLの用語解説
4. 今回のアプリの構成
5. ハンズオン: 簡単なTODOアプリを作ってみる

---

## 1. 私がGraphQLを使い始めたワケ

---

### 発表者の情報

* 普段はRails・JQueryで開発していることが多い。
* RailsでAPIは何度か作ったことはある。
* フロントエンド初心者(Reactはちょっとわかる。Reduxはわからん)
* Reactを使ったイケてるフロントエンドアプリ開発をしたいと思っている。

---

Reactを使ったイケてるフロントエンドアプリ開発をしたいと思っている☺️

しかしそれには弊害が...

---

## 弊害😭

* ① バックエンド(API)を作らないといけない
* ② フロントエンドとバックエンドの繋ぎこみが難しい
* ③ 未だによくわからんRedux...

---

## フロントエンドをやりたいにバックエンドをやらねばならぬジレンマ😭

---

## なかなかフロントエンドのスタート地点に立てない!!!
## (フロントエンド開発に集中したい🔥)

---

## そこで現れたのがGraphQLとそのクライアントライブラリである😊

---

* ① バックエンド(API)を作らないといけない(めんどい)

=> GraphQLを使えば簡単にバックエンド(API)アプリが作られる!😆

---

* ② フロントエンドとバックエンドの繋ぎこみが難しい

=> apollo-client(GraphQLのクライアントライブラリ)を使えば、簡単に繋ぎこみが行える!😆

---

* ③ 未だによくわからんRedux...

=> 簡単なアプリであればReduxを使う必要がない(というかhookの登場でいらなくなるという噂)😆

---

詳しくはは最後のハンズオンにて😉

---

### 2. GraphQLとは

---

A query language for your API

APIのための問い合わせ言語

---

### 3つの特徴

1. Ask for what you need get exactly that
2. Get many resorces in a single request
3. Decribe what's possible with a type system

---

### 1. Ask for what you need get exactly that

必要な要求だけ応答を得ることができる

クエリ例:

Request
```
query {
	monster {
    name
    type
  }
}

```
monsterは他にもpowerやhpなどももっている

Response
```
{
	"data": {
    "monster": {
      "name": "スライム",
      "type": "スライム属"
    }
  }
}
```

---

### 2. Get many resorces in a single request

関連する情報も一つのRequestで得ることができる

Request
```
query {
	monster {
    name
    actions {
      name
    }
  }
}

```

Response
```
{
	"data": {
    "monster": {
      "name": "ホイミスライム",
      "actions": [
        { "name": "ホイミ" },
        { "name": "こうげき" },
        { "name": "にげる" }
      ]
    }
  }
}
```

---

### 3. Decribe what's possible with a type system

必要なデータは必ずフィールドを指定して要求する。
フィールドは必ず型が決まっている。

---

### よくRESTと比較される

### REST
* リソースごとにURL(エンドポイント)を定義する。
* 返ってくるフィールド決まっている(不必要なフィールドまで返ってくる)。

### GraphQL
* リソースごとにスキーマを定義する。
* エンドポイント一つ。メソッドはPOSTのみ。
* 返ってくるフィールドはリクエストで柔軟に変えられる。

---

## とりあえず触ってみるなら

GraphiQL.app(GraphQLの実行環境アプリ)

GithubAPI

https://developer.github.com/v4/explorer/

---

## GraphQLの用語解説

```
* スキーマ(Shemas)
* クエリ(Query)
* フィールド(Field)
* 型(Types)
* 別名(Aliases)
* フラグメント(Fragments)
* 操作名(Operation Name)
* 変数(Variables)
* ミューテーション(Mutation)
* インラインフラグメント(Inline Fragments)
* 型名(__typename)
```

---

### スキーマ(Shemas)、クエリ(Query)、フィールド(Field) 、型(Types)

GithubAPI

maceraというユーザのloginとnameとavatarUrlを取得するクエリ

```
query {
	user (login: "macera"){
    login
    name
    avatarUrl
  }
}

スキーマ => APIの定義。必ず何かの型を定義しないといけない

user => 取得したいフィールド。User型(オブジェクト型)

login、name => 取得したいサブフィールド。String型(スカラー型)

(login: 'macera') => 引数(Arguments)

```

---

maceraというユーザのloginとnameと、
maceraがownerのbackend_todo_appリポジトリのdescription
を取得するクエリ

```
query {
  repository (owner: "macera", name: "backend_todo_app"){
    description
  }
	user (login: "macera"){
    login
    name
  }
}
```

---

### 別名(Aliases)

エラーになる

```
query {
  user (login: "macera"){
    login
    name
  }
	user (login: "test_user"){
    login
    name
  }
}
```
---

### 別名(Aliases)

別名を使うとOK

```
query {
  user1: user (login: "macera"){
    login
    name
  }
	user2: user (login: "test_user"){
    login
    name
  }
}
```

---

### フラグメント(Fragments)

```
query {
  user1: user (login: "macera"){
    ...userFields
  }
	user2: user (login: "test_user"){
    ...userFields
  }
}

fragment userFields on User {
	login
	name
}
```

javascriptのスプレッド演算子(...)みたいなので、フラグメントを展開する

---

### 操作名(Operation Name)

* 操作名がない場合、「query」を省略できる
* 無名の操作名は1つしか定義できない(ユニークな名前をつける)

エラー

```
query {
	user (login: "macera"){
    login
    name
  }
}
query {
	user (login: "test_user"){
    login
    name
  }
}

```

---

### 操作名(Operation Name)

OK

```
query getUser1 {
	user (login: "macera"){
    login
    name
  }
}
query getUser2 {
	user (login: "test_user"){
    login
    name
  }
}

```

---

### 変数(Variables)

よく使う!!!

Query Variables
```
{
	"login": "macera"
}

```

```
query ($login: String!){
	user (login: $login){
    login
    name
  }
}
```

---

### ミューテーション(Mutation)

データを更新・削除する

QueryがREADとするなら

Mutationは、CREATE、UPDATE、DELETEに当たる

---

### ミューテーション(Mutation)

backend_todo_appリポジトリのスターを追加する

```
mutation addStar {
	addStar (input: {starrableId: "MDEwOlJlcG9zaXRvcnkxNzIzMzIwMTk="}){
    starrable{
      id
      viewerHasStarred
    }
  }
}
```
---

### インラインフラグメント(Inline Fragments)

slimeという名前がつくUserとOrganizationを返す

```
query {
  search (query: "slime", type: USER, first: 100) {
    nodes {
      __typename
      ... on User {
        name
        url
      }
      ... on Organization {
        name
        url
      }
    }
  }
}
```

---

### 型名(__typename)

返された型の名称を返す

```
{
  user(login: "macera") {
    login
    name
    __typename
  }
}

```

"User"が返ってくる

---

### いろんな型

GraphiqlのDocで黄色表示されているものは全部型

* スカラー型(Scalar Types)

  GraphQLにビルトインされている、これ以上分解できない最小単位

  String、ID、URI、Intなど

* オブジェクト型(Object Types)

  開発者が定義する

  スカラー型やオブジェクト型などを組み合わせたもの

  GitHubAPIではUserやRepositoryなど

他にもある

---

4. 今回のアプリの構成

---

## 実演😃

---

### フロント

React + apollo-client(GraphQLのクライアントアプリ)

### バックエンド

GraphQL + RubyonRails + SQLite

---

### 5. ハンズオン: 簡単なTODOアプリを作ってみる

手順書

バックエンド

https://github.com/macera/backend_todo_app

フロントエンド

https://github.com/macera/front-todo-app

---

参考サイト

* 「雑に始める GraphQL Ruby【class-based API】」

https://qiita.com/vsanna/items/031aa5a17a2f284eb65d

* 「AWS AppSyncとReactでToDoアプリを作ってみよう(3) Reactアプリの作成」

https://qiita.com/daikiojm/items/da81259a3e365fee9333

* 「GraphQL with React入門 - QueryとMutationを学びPaginationの実装にチャレンジ！」(有料)

https://www.udemy.com/graphql-with-react/

* 「apollo-boost」

https://github.com/apollographql/apollo-client/tree/master/packages/apollo-boost

---

# おわり

今日のスライド:
https://macera.github.io/slides/docs/kunibikirb8/

           </script>
       </section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				transition: 'default',
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
    <style>
      body { text-transform: none; }
    </style>
	</body>
</html>
